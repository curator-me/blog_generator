{% extends "base.html" %} {% block content %}

<div class="card text-center">
  <div class="card-header">Featured</div>
  <div class="card-body">
    <h5 class="card-title">Welcome to the AI Blog Generator</h5>
    <p class="card-text">
      Generate high-quality blog articles from YouTube videos using artificial
      intelligence. Simply enter the YouTube link below and let the AI create
      content for you!
    </p>

    <form id="blog-generator-form" class="d-flex justify-content-center">
      {% csrf_token %}
      <input
        type="url"
        id="youtube_url"
        name="youtube_url"
        class="form-control w-50 me-2"
        placeholder="Enter YouTube video link"
        required
      />
      <button type="submit" class="btn btn-primary">Generate Blog</button>
    </form>

    <div id="loading-indicator" class="mt-3" style="display: none">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Generating your blog... Please wait</p>
    </div>

    <div
      id="generated-blog-container"
      class="text-start mt-4 px-4"
      style="display: none"
    >
      <div
        id="error-message"
        class="alert alert-danger"
        style="display: none"
      ></div>
      <h4 id="blog-title" class="mb-3"></h4>
      <div class="card text-start">
        <div id="blog-content" class="card-body">
          <!-- here the generated blog will appear -->
        </div>
      </div>
    </div>
  </div>
  <div class="card-footer text-muted">Updated 2 days ago</div>
</div>

<script>
  document
    .getElementById("blog-generator-form")
    .addEventListener("submit", function (e) {
      e.preventDefault();

      const form = e.target;
      const urlInput = document.getElementById("youtube_url");
      const loadingIndicator = document.getElementById("loading-indicator");
      const blogContainer = document.getElementById("generated-blog-container");
      const errorMessage = document.getElementById("error-message");

      // Reset UI
      errorMessage.style.display = "none";
      loadingIndicator.style.display = "block";
      blogContainer.style.display = "none";

      const csrfToken = document.querySelector(
        "[name=csrfmiddlewaretoken]"
      ).value;

      console.log(`youtube_url=${encodeURIComponent(urlInput.value)}`);
      fetch("{% url 'generate_blog' %}", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
          "X-CSRFToken": csrfToken,
        },
        body: `youtube_url=${encodeURIComponent(urlInput.value)}`,
      })
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json();
        })
        .then((data) => {
          if (data.error) {
            throw new Error(data.error);
          }
          // Display generated blog
          document.getElementById("blog-title").textContent = data.title || "Generated Blog";
          document.getElementById("blog-content").innerHTML = data.blog;
          blogContainer.style.display = "block";
        })
        .catch((error) => {
          // Display error
          errorMessage.textContent =
            error.message || "An error occurred during generation";
          errorMessage.style.display = "block";
        })
        .finally(() => {
          loadingIndicator.style.display = "none";
        });
    });
</script>

{% endblock content %}
